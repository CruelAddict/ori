{
  "openrpc": "1.3.2",
  "info": {
    "title": "Ori Database Explorer API",
    "description": "JSON-RPC API for exploring database configurations and metadata",
    "version": "1.0.0"
  },
  "methods": [
    {
      "name": "listConfigurations",
      "summary": "List all database configurations",
      "description": "Returns a list of all configured database connections from the server configuration file",
      "params": [],
      "result": {
        "name": "ConfigurationsResult",
        "description": "List of database connection configurations",
        "schema": {
          "$ref": "#/components/schemas/ConfigurationsResult"
        }
      }
    },
    {
      "name": "connect",
      "summary": "Open a database connection by configuration name",
      "description": "If the connection already exists, returns success. Otherwise starts connecting asynchronously and returns connecting.",
      "params": [
        {
          "name": "connection",
          "schema": {
            "$ref": "#/components/schemas/ConnectParams"
          }
        }
      ],
      "result": {
        "name": "ConnectResult",
        "schema": {
          "$ref": "#/components/schemas/ConnectResult"
        }
      }
    },
    {
      "name": "getNodes",
      "summary": "Retrieve graph nodes for a configuration",
      "description": "Returns either top-level nodes (when nodeIDs is omitted) or fully hydrated nodes for the provided IDs. When edges exceed the limit the truncated flag is set.",
      "params": [
        {
          "name": "request",
          "schema": {
            "$ref": "#/components/schemas/GetNodesParams"
          }
        }
      ],
      "result": {
        "name": "GetNodesResult",
        "schema": {
          "$ref": "#/components/schemas/GetNodesResult"
        }
      }
    },
    {
      "name": "query.exec",
      "summary": "Start execution of a database query or statement asynchronously.",
      "description": "Executes a database query asynchronously and returns a job ID. Results are stored in memory and can be retrieved later. Completion is announced via SSE.",
      "params": [
        {
          "name": "request",
          "schema": {
            "$ref": "#/components/schemas/QueryExecParams"
          }
        }
      ],
      "result": {
        "name": "QueryExecResult",
        "schema": {
          "$ref": "#/components/schemas/QueryExecResult"
        }
      }
    },
    {
      "name": "query.getResult",
      "summary": "Returns result of a completed db query by its job ID",
      "params": [
        {
          "name": "request",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/QueryGetResultParams"
          }
        }
      ],
      "result": {
        "name": "QueryGetResultResult",
        "schema": {
          "$ref": "#/components/schemas/QueryGetResultResult"
        }
      }
    }
  ],
  "components": {
    "schemas": {
      "ConfigurationsResult": {
        "type": "object",
        "properties": {
          "connections": {
            "type": "array",
            "description": "Array of database connection configurations",
            "items": {
              "$ref": "#/components/schemas/ConnectionConfig"
            }
          }
        },
        "required": [
          "connections"
        ]
      },
      "ConnectionConfig": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Human-readable connection name"
          },
          "type": {
            "type": "string",
            "description": "Database type (mysql, postgresql, etc.)"
          },
          "host": {
            "type": "string",
            "description": "Database host address"
          },
          "port": {
            "type": "integer",
            "description": "Database port number"
          },
          "database": {
            "type": "string",
            "description": "Database name"
          },
          "username": {
            "type": "string",
            "description": "Database username"
          },
          "password": {
            "$ref": "#/components/schemas/PasswordConfig"
          }
        },
        "required": [
          "name",
          "type",
          "host",
          "port",
          "database",
          "username",
          "password"
        ]
      },
      "PasswordConfig": {
        "type": "object",
        "description": "Password retrieval configuration",
        "properties": {
          "type": {
            "type": "string",
            "description": "Password provider type",
            "enum": [
              "plain_text",
              "shell",
              "keychain"
            ]
          },
          "key": {
            "type": "string",
            "description": "Provider-specific value (password text, shell command, or keychain account)"
          }
        },
        "required": [
          "type",
          "key"
        ]
      },
      "ConnectParams": {
        "type": "object",
        "properties": {
          "configurationName": {
            "type": "string",
            "description": "Connection name from configuration"
          }
        },
        "required": [
          "configurationName"
        ]
      },
      "ConnectResult": {
        "type": "object",
        "properties": {
          "result": {
            "type": "string",
            "enum": [
              "success",
              "fail",
              "connecting"
            ]
          },
          "userMessage": {
            "type": "string",
            "description": "Optional message for the user"
          }
        },
        "required": [
          "result"
        ]
      },
      "NodeEdge": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of related node IDs"
          },
          "truncated": {
            "type": "boolean",
            "description": "True when more related nodes exist beyond the returned slice"
          }
        },
        "required": [
          "items",
          "truncated"
        ]
      },
      "Node": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "type": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "attributes": {
            "type": "object",
            "additionalProperties": {}
          },
          "edges": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/NodeEdge"
            }
          }
        },
        "required": [
          "id",
          "type",
          "name",
          "attributes",
          "edges"
        ]
      },
      "GetNodesParams": {
        "type": "object",
        "properties": {
          "configurationName": {
            "type": "string",
            "description": "Connection name from configuration"
          },
          "nodeIDs": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "maxItems": 1000,
            "description": "Optional node IDs to hydrate"
          }
        },
        "required": [
          "configurationName"
        ]
      },
      "GetNodesResult": {
        "type": "object",
        "properties": {
          "nodes": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Node"
            }
          }
        },
        "required": [
          "nodes"
        ]
      },
      "QueryExecParams": {
        "type": "object",
        "properties": {
          "configurationName": {
            "type": "string",
            "description": "Name of the database configuration to use"
          },
          "query": {
            "type": "string",
            "description": "Database query or statement to execute"
          },
          "params": {
            "description": "Query parameters (can be object for named or array for positional)"
          },
          "options": {
            "type": "object",
            "properties": {
              "maxRows": {
                "type": "integer",
                "minimum": 1,
                "maximum": 1000,
                "default": 200,
                "description": "Maximum rows to store in memory (truncate if exceeded)"
              }
            },
            "description": "Execution options"
          }
        },
        "required": [
          "configurationName",
          "query"
        ]
      },
      "QueryExecResult": {
        "type": "object",
        "properties": {
          "jobId": {
            "type": "string",
            "description": "Unique job identifier for tracking execution"
          },
          "status": {
            "type": "string",
            "enum": [
              "running",
              "failed"
            ],
            "description": "Initial job status"
          },
          "message": {
            "type": "string",
            "description": "Optional status message"
          }
        },
        "required": [
          "jobId",
          "status"
        ]
      },
      "QueryGetResultParams": {
        "type": "object",
        "properties": {
          "jobId": {
            "type": "string",
            "description": "Unique job identifier for tracking execution"
          },
          "limit": {
            "type": "integer",
            "description": "Max rows in result set"
          },
          "offset": {
            "type": "integer",
            "description": "Amount of rows to skip when retrieving the result set"
          }
        },
        "required": [
          "jobId"
        ]
      },
      "QueryGetResultResult": {
        "type": "object",
        "properties": {
          "columns": {
            "type": "array",
            "items": {
              "type": "object",
              "required": [
                "name",
                "type"
              ],
              "properties": {
                "name": {
                  "type": "string"
                },
                "type": {
                  "type": "string"
                }
              }
            }
          },
          "rows": {
            "type": "array",
            "items": {
              "type": "array",
              "items": {}
            },
            "description": "Row values in column order."
          },
          "row_count": {
            "type": "integer",
            "description": "Number of rows actually stored."
          },
          "truncated": {
            "type": "boolean",
            "description": "True if result was cut due to maxRows limit."
          }
        },
        "required": [
          "columns",
          "rows",
          "row_count",
          "truncated"
        ]
      }
    }
  }
}
